# 2026-02-28 – Governance Setup & Multi-Tenant Schema Foundation
---

## Objective

1. Establish professional project structure and engineering discipline for **GrihaLedger**.
2. Initialize PostgreSQL development environment.
3. Implement foundational multi-tenant identity schema.

---

# Part 1 – Project Structuring & Governance

## Work Completed

- Finalized project name: **GrihaLedger**
- Defined positioning as a fintech SaaS-style data platform
- Created structured repository layout:
  - `src/`
  - `sql/`
  - `tests/`
  - `docs/`
  - `scripts/`
- Established development guidelines document
- Adopted Conventional Commits standard
- Defined single-branch policy (`main` always runnable)
- Implemented execution tracking:
  - Google Sheet (time + gap detection)
  - GitHub commits as activity proof
- Adopted forward-only SQL migration discipline (001, 002, 003...)

## Architectural Decisions

- Phase 1 scope limited to OLTP core only
- No Docker, dbt, Airflow in March
- No hard deletes in financial model (future rule)
- Surrogate keys preferred over natural keys
- Many-to-many modeling via bridge table

---

# Part 2 – PostgreSQL Environment Troubleshooting

## Issue Encountered

Attempted connection using:

    psql -U postgres

Error:

    connection to server at "localhost", port 5432 failed: Connection refused

---

## Investigation

1. Verified PostgreSQL service via Windows Services  
   → Service running.

2. Checked active listening ports:

       netstat -ano | findstr 5432

   → No process bound to 5432.

3. Attempted alternate port:

       psql -p 5433 -U postgres

   → Connection successful.

4. Verified configuration in:

       C:\Program Files\PostgreSQL\18\data\postgresql.conf

   Found:
       port = 5433
       listen_addresses = 'localhost'

---

## Root Cause

PostgreSQL server configured to run on port **5433** (not default 5432).

---

## Resolution

Connected using correct port:

    psql -p 5433 -U postgres

Executed:

    CREATE DATABASE grihaledger_dev;
    \c grihaledger_dev
    CREATE SCHEMA raw;

---

# Part 3 – Schema Implementation (Reproducible via SQL Scripts)

Adopted file-based migration approach:

- `001_create_users.sql`
- `002_create_households.sql`
- `003_create_household_members.sql`

Tables created:

1. `raw.users`
   - Global identity
   - email UNIQUE
   - Surrogate primary key

2. `raw.households`
   - Tenant entity
   - Surrogate primary key

3. `raw.household_members`
   - Bridge table (many-to-many)
   - Foreign keys to users & households
   - `UNIQUE (household_id, user_id)`
   - Role constraint: ('admin','member','viewer')

Verified via:

    \dt raw.*

---

## Outcome

- Development database operational.
- Multi-tenant identity model implemented correctly.
- Schema fully reproducible via SQL files.
- Migration discipline established from start.

---

## Key Learnings

- Service status ≠ correct port binding.
- Always verify DB configuration before assuming failure.
- Use surrogate keys for stability and performance.
- Many-to-many relationships require bridge tables.
- Never edit historical migration files once applied.
- Reproducibility > manual DB manipulation.

---

## Next Steps

- Insert test data to validate constraints.
- Verify UNIQUE and foreign key enforcement.
- Begin design of `raw.accounts` table.

Status: In Progress